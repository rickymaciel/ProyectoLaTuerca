@model LaTuerca.Models.FacturaCliente
@{
    ViewBag.Title = "Factura";
}
@if (TempData["notice"] != null)
{
    <div class="pad margin no-print" id="mensaje">
        <div class="callout callout-success" style="margin-bottom: 0!important;">
            <h4><i class="fa fa-info"></i> Alerta:</h4>
            @TempData["notice"]
        </div>
    </div>
}
<section class="content">
    @using (Html.BeginForm())
    {
        @Html.AntiForgeryToken()
        @Html.HiddenFor(model => model.Id)
        <div class="row">
            <div class="col-lg-12">
                <div class="box box-primary form-horizontal">
                    <div class="box-body form-horizontal">
                        <div class="user-block page-header">
                            <img class="img-circle" src="~/Content/img/mundo.jpeg" width="50" title="Mundo Tuerca" alt="Mundo Tuerca">
                            <span class="username"><a href="#">Mundo Tuerca, Inc</a></span>
                            <small class="description">Mcal. Estigarribia c/ Artigas, Zona Alta</small>
                           <!--  <small class="description">Encarnación, Itapúa</small>
                            <small class="description">Telefono: (071) 243-345</small> -->
                        </div>
                        <div class="col-lg-3">
                            <div class="form-group">
                                @Html.LabelFor(model => model.ClienteId, htmlAttributes: new { @class = "control-label col-md-3" })
                                <div class="col-md-9 has-feedback">
                                    @Html.DropDownList("ClienteId", null, "Seleccionar Cliente", htmlAttributes: new { @class = "form-control" })
                                    <span class="glyphicon glyphicon-search form-control-feedback text-muted"></span>
                                    @Html.ValidationMessageFor(model => model.ClienteId, "", new { @class = "text-danger" })
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3">
                            <div class="form-group">
                                @Html.LabelFor(model => model.Fecha, htmlAttributes: new { @class = "control-label col-md-3" })
                                <div class="col-md-9 has-feedback input-daterange" data-provide="datepicker">
                                    @Html.EditorFor(model => model.Fecha, new { htmlAttributes = new { @class = "form-control input-sm", @id = "fechacompra", placeholder = "Fecha", @required = "true", aria_required = "true" } })
                                    <span class="glyphicon glyphicon-calendar form-control-feedback text-muted"></span>
                                    @Html.ValidationMessageFor(model => model.Fecha, "", new { @class = "text-danger" })
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3">
                            <div class="form-group">
                                @Html.LabelFor(model => model.FechaPago, htmlAttributes: new { @class = "control-label col-md-3" })
                                <div class="col-md-9 has-feedback input-daterange" data-provide="datepicker">
                                    @Html.EditorFor(model => model.FechaPago, new { htmlAttributes = new { @class = "form-control input-sm", @id = "fechacompra", placeholder = "Fecha", @required = "true", aria_required = "true" } })
                                    <span class="glyphicon glyphicon-calendar form-control-feedback text-muted"></span>
                                    @Html.ValidationMessageFor(model => model.FechaPago, "", new { @class = "text-danger" })
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3">
                            <div class="form-group">
                                <div class="has-feedback">
                                    @Html.LabelFor(model => model.NumeroFactura, htmlAttributes: new { @class = "control-label col-md-3" })
                                    <div class="col-md-9">
                                        @Html.EditorFor(model => model.NumeroFactura, new { htmlAttributes = new { @class = "form-control input-sm text-danger", placeholder = "Nº de Factura", @required = "true", aria_required = "true", @readonly = "true" } })
                                        <span class="glyphicon glyphicon-inbox form-control-feedback text-muted"></span>
                                        @Html.ValidationMessageFor(model => model.NumeroFactura, "", new { @class = "text-danger" })
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3">
                            <div class="form-group">
                                <div class="has-feedback">
                                    @Html.LabelFor(model => model.Metodo, htmlAttributes: new { @class = "control-label col-md-3" })
                                    <div class="col-md-9">
                                        @Html.DropDownList("Metodo", new SelectList(Enum.GetValues(typeof(LaTuerca.Controllers.FacturaProveedorsController.Metodo))), "Método de pago", new { @class = "form-control input-sm" })
                                        @Html.ValidationMessageFor(model => model.Metodo, "", new { @class = "text-danger" })
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3">
                            <div class="form-group">
                                @Html.LabelFor(model => model.Total, htmlAttributes: new { @class = "control-label col-md-3" })
                                <div class="col-md-9">
                                    @Html.EditorFor(model => model.Total, new { htmlAttributes = new { @class = "form-control input-sm tip", title = "Total a pagar", placeholder = "Total", @required = "true", aria_required = "true", @readonly = "readonly" } })
                                    @Html.ValidationMessageFor(model => model.Total, "", new { @class = "text-danger" })
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3">
                            <div class="form-group">
                                @Html.LabelFor(model => model.TotalPagado, htmlAttributes: new { @class = "control-label col-md-3" })
                                <div class="col-md-9">
                                    @Html.EditorFor(model => model.TotalPagado, new { htmlAttributes = new { @class = "form-control input-sm tip", title = "Ingresar monto a pagar", placeholder = "Total Pagado", @required = "true", aria_required = "true" } })
                                    @Html.ValidationMessageFor(model => model.TotalPagado, "", new { @class = "text-danger" })
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="box-footer">
                        @if (Model.Pagado == true)
                        {
                            <div class="form-horizontal">
                                @Html.ActionLink("Imprimir Factura", "Print", new { id = Model.Id }, new { @target = "_blank", @class = "btn btn-primary pull-right", @id = "ImprimirFactura", @data_original_title = "Imprimir Factura" })
                            </div>
                        }
                        else
                        {

                            <div class="form-horizontal">
                                @Html.EditorFor(model => model.Pagado, "", new { @required = "true" })
                                @Html.ValidationMessageFor(model => model.Pagado, "", new { @class = "text-danger" })
                                <label class="control-label">Confirmar Pago</label>
                                <button type="submit" id="Pagar" class="btn btn-success pull-right"><i class="fa fa-credit-card"></i> Confirmar Pago</button>
                            </div>
                        }
                    </div>

                </div>
            </div>
            <div class="col-lg-12">
                <div class="box box-primary direct-chat direct-chat-primary">
                    <div class="box-header with-border">
                        <h3 class="box-title">Detalles</h3>
                    </div>
                    <div class="box-body">
                        <div class=" table-responsive">
                            <table class="table table-striped table-condensed table-hover table-inverse tabledata" id="itemsTable">
                                <thead>
                                    <tr class="bg-primary">
                                        <th class="col-lg-1"><i class="im-remove"></i></th>
                                        <th class="col-lg-1">Item</th>
                                        <th class="col-lg-4">Description</th>
                                        <th class="col-lg-3">Cantidad</th>
                                        <th class="col-lg-3">Precio Unit.</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var item in Model.detallesFacturaCliente)
                                    {
                                        <tr class="item-row">
                                            <td class="col-lg-1"><i class="im-radio-checked"></i></td>
                                            <td class="col-lg-1">
                                                @item.RepuestoId
                                            </td>
                                            <td class="col-lg-4">
                                                @item.Repuesto.Nombre
                                            </td>
                                            <td class="col-lg-3">
                                                @item.Cantidad
                                            </td>
                                            <td class="col-lg-3">
                                                @item.Precio
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    }
</section>
@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    @Scripts.Render("~/bundles/jqueryCompra")
    <script>
        $(document).ready(function () {
            $("#Pagar").on('click', function () {
                //e.preventDefault();
                var Total = $("#Total").val();
                var TotalPagado = $("#TotalPagado").val(Total);
                $("input[name=Pagado]").attr('checked', true);
                $("input[name=Pagado]").val("true");

                $('#Pagado').prop('checked', true);
                $('#Pagado').attr('checked', true);
                $('#Pagado').addClass("icheckbox_square-blue checked");
                $('#Pagado').attr('aria-checked', 'true');

                $(".icheckbox_square-blue").removeClass("icheckbox_square-blue").addClass("icheckbox_square-blue checked");
            });
        });
    </script>
}