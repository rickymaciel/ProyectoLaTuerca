@using Microsoft.AspNet.Identity
@if (!Request.IsAuthenticated)
{
    Response.Redirect("Account/Login");
}
@{
    string Nick = "";
    int IndexNick = 0;
    string NewNick = "";
    string Name = "";
}
@if (Request.IsAuthenticated)
{
    if (User.Identity.GetUserName() != "")
    {
        Nick = User.Identity.GetUserName();
        IndexNick = Nick.IndexOf("@");

        NewNick = Nick.Substring(0, IndexNick);
        Name = User.Identity.Name;
    }
}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewBag.Title</title>
    @Styles.Render("~/Content/css")
    @Scripts.Render("~/bundles/modernizr")

</head>
<body class="sidebar-mini skin-blue">
    <div class="wrapper">
        <header class="main-header">
            <!-- Logo -->
            <a href="http://localhost:53172/" class="logo">
                <i class="fa-adjust fa-wrench"></i>
                <span class="logo-l" id="NombreEmpresa"></span>
                <span class="logo-mini" id="NombreCorto"></span>
            </a>
            <nav class="navbar navbar-static-top" role="navigation">
                <a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">
                    <span class="sr-only">Toggle navigation</span>
                </a>
                @Html.Partial("_LoginPartial")
            </nav>
        </header>
        @if (Request.IsAuthenticated)
        {
            <aside class="main-sidebar">
                <section class="sidebar">
                    <!-- Sidebar user panel -->
                    <div class="user-panel">
                        <div class="pull-left image">
                            <img src="~/Content/img/mundo.jpeg" class="img-circle" alt="@ViewBag.Title">
                        </div>
                        <div class="pull-left info">
                            <p>@ViewBag.Title</p>
                            <a href="#"><i class="fa fa-circle text-success"></i><span class="text-uppercase text-gray">@NewNick</span> </a>
                        </div>
                    </div>
                    <ul class="sidebar-menu">
                        <li class="header">MENÚ</li>
                        @{ Html.RenderAction("MainMenu", "Menus"); }
                    </ul>
                </section>
            </aside>
        }
        <div class="content-wrapper">
            @RenderBody()
        </div>
        <footer class="main-footer">
            <div class="pull-right hidden-xs">
                <img src="~/Content/img/mu.png" height="30" />
            </div>
            <strong>Copyright &copy; @DateTime.Now.Year - </strong><strong id="NombreFooter"></strong>.   Todos los derechos reservados. <small class="text-right" id="Web"></small>
        </footer>
        <div class="control-sidebar-bg"></div>
    </div><!-- ./wrapper -->
    @Scripts.Render("~/bundles/jquery")
    @Scripts.Render("~/bundles/bootstrap")
    @RenderSection("scripts", required: false)
    <script>
        $(function () {
            load_marcas();
            load_clientes();
            function load_clientes() {
                var RazonSocialClientes = {
                    url: "/FacturaClientes/getClientes",
                    getValue: "RazonSocial",
                    list: {
                        match: {
                            enabled: true
                        },
                        maxNumberOfElements: 8,
                        sort: {
                            enabled: true
                        },
                        onSelectItemEvent: function () {
                            var ClienteId = $(".RazonSocial").getSelectedItemData().Id;
                            var RazonSocial = $(".RazonSocial").getSelectedItemData().RazonSocial;
                            var Documento = $(".RazonSocial").getSelectedItemData().Documento;
                            var Telefono = $(".RazonSocial").getSelectedItemData().Telefono;
                            var Direccion = $(".RazonSocial").getSelectedItemData().Direccion;

                            $("#ClienteId").val(ClienteId).trigger("change");
                            //$("#RazonSocial").val(RazonSocial).trigger("change");
                            //$("#Ruc").val(Ruc).trigger("change");
                            //$("#Telefono").val(Telefono).trigger("change");
                            //$("#Direccion").val(Direccion).trigger("change");
                            $("#saveInvoiceBtn").removeClass('disabled');
                            $("#InfoCliente").val(RazonSocial + ' - R.U.C.: ' + Documento + ' - Direccion:' + Direccion).trigger("change");
                            //$("#addRowBtn").removeClass('disabled');
                        },
                    },
                    //theme: "plate-dark",
                    //theme: "square"
                };
                $("input#RazonSocialCliente").easyAutocomplete(RazonSocialClientes);
                $(".easy-autocomplete-container").addClass("text-danger");

            }
            function load_marcas() {
                var codigoArticulo = {
                    url: "/Modelos/getMarcas",
                    getValue: "Nombre",
                    list: {
                        match: {
                            enabled: true
                        },
                        maxNumberOfElements: 8,
                        sort: {
                            enabled: true
                        },
                        onSelectItemEvent: function () {
                            var MarcaId = $(".Marca").getSelectedItemData().Id;
                            $("#MarcaId").val(MarcaId).trigger("change");
                        },
                    },
                    //theme: "plate-dark",
                    theme: "square"
                };
                $("input.Marca").easyAutocomplete(codigoArticulo);
                $(".easy-autocomplete-container").addClass("text-danger");

            };

            var serviceURL = 'http://localhost:53172/Cajas/ObtenerUltimoCajaAbierto';
            $.ajax({
                type: "POST",
                url: serviceURL,
                data: param = "",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: successFunc,
                error: errorFunc
            });

            function successFunc(data, status) {
                //alert(data);
                if (data == 0) {
                    $("li#closeCaja").removeClass("hidden");
                }
                else {
                    $("li#openCaja").removeClass("hidden");
                    $("i#idcaja").html(data);
                }
            };
            function errorFunc() {
                alert('error');
            };


            var empresaURL = 'http://localhost:53172/Empresas/getEmpresa';

            $.ajax({
                type: "POST",
                url: empresaURL,
                data: param = "",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: successFunc2,
                error: errorFunc2
            });

            function successFunc2(data, status) {
                $.each(data, function (index) {
                    var nombre = data[index].Nombre;
                    var nombrecorto = data[index].NombreCorto;
                    var Ruc = data[index].Ruc;
                    var Email = data[index].Email;
                    var Pais = data[index].Pais;
                    var Ciudad = data[index].Ciudad;
                    var Departamento = data[index].Departamento;
                    var Web = data[index].Web;
                    var Telefono = data[index].Telefono;
                    var Direccion = data[index].Direccion;
                    $("#NombreFooter").append("<a target='_blank' href='" + Web + "'>" + nombre + "</a>");
                    $("#NombreEmpresa").append(nombre);
                    $("#NombreCorto").append(nombrecorto);
                    $("#Ruc").append(Ruc);
                    $("#Email").append(Email);
                    $("#Pais").append(Pais);
                    $("#Departamento").append(Departamento);
                    $("#Ciudad").append(Ciudad);
                    $("#Telefono").append(Telefono);
                    $("#Direccion").append(Direccion);
                })
            };

            function errorFunc2() {
                alert('error');
            };
            var oTable = $('#tablaMenu').DataTable({
                dom: 'Bfrtip',
                buttons: [
                    'copyHtml5',
                    'excelHtml5',
                    'csvHtml5',
                    'pdfHtml5'
                ],
                "bProcessing": true,
                "sPaginationType": "full_numbers",
                "paging": true,
                "iDisplayLength": 8,
                "bPaginate": true,
                "bSort": true,
                "oLanguage": {
                    "oPaginate": {
                        "sPrevious": "←",
                        "sNext": "→",
                        "sLast": "»",
                        "sFirst": "«"
                    },
                    "sProcessing": "Procesando...",
                    "sLengthMenu": "Mostrar _MENU_ registros",
                    "sZeroRecords": "No se encontraron resultados",
                    "sEmptyTable": "Ningún dato disponible en esta tabla",
                    "sInfo": "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
                    "sInfoEmpty": "Mostrando registros del 0 al 0 de un total de 0 registros",
                    "sInfoFiltered": "(filtrado de un total de _MAX_ registros)",
                    "sInfoPostFix": "",
                    "sSearch": "Buscar:",
                    "sUrl": "",
                    "sInfoThousands": ",",
                    "sLoadingRecords": "Cargando...",
                    "oAria": {
                        "sSortAscending": ": Activar para ordenar la columna de manera ascendente",
                        "sSortDescending": ": Activar para ordenar la columna de manera descendente"
                    }
                }
            });

            oTable.buttons().container().appendTo('#tablaMenu .col-md-6:eq(0)');

            $("[data-mask]").inputmask();
            /*
            $("[data-mask]").inputmask("phone", {
                url: "C:/Users/MACIEL/Desktop/GITHUB/MUNDOTUERCA/LaTuerca/Scripts/input-mask/phone-codes/phone-codes.json",
                onKeyValidation: function () { //show some metadata in the console
                    console.log($(this).inputmask("getmetadata")["name_en"]);
                }
            });
            */
            $('input').iCheck({
                checkboxClass: 'icheckbox_minimal-blue',
                radioClass: 'icheckbox_minimal-blue',
                increaseArea: '20%' // optional
            });
            $('#mensaje').delay(6000).fadeOut(2000);
            $("#ClienteIdCliente").val('');
            $("[data-toggle=tooltip]").tooltip();
            $(".tip").tooltip({ placement: 'top' });
            $(".tipR").tooltip({ placement: 'right' });
            $(".tipB").tooltip({ placement: 'bottom' });
            $(".tipL").tooltip({ placement: 'left' });
            //$('#preciocosto').val('');
            $("#nombre").removeClass('has-error');
            $("#guardar").click(function () {
                var nombre = $('#nombre').val();
                var modelo = $('#select-modelo').val();
                var marca = $('#select-marca').val();
                var categoria = $('#select-categoria').val();
                var proveedor = $('#select-proveedor').val();
                var costo = parseInt($('#preciocosto').val());
                if (costo < 1) {
                    //$("#mensaje").html('<div class="label label-warning">Debe ingresar el precio de costo</div>');
                    swal({
                        title: "Requerido <small>(*)</small>",
                        text: '<strong>Debe ingresar el precio de costo<strong>.',
                        type: "warning",
                    });
                    $("#preciocoste").addClass('has-error');
                } else {
                    $("#preciocoste").removeClass('has-error');
                };
                if (proveedor == "") {
                    //$("#mensaje").html('<div class="label label-warning">Debe seleccionar un proveedor</div>');
                    swal({
                        title: "Requerido <small>(*)</small>",
                        text: '<strong>Debe seleccionar un proveedor<strong>.',
                        type: "warning",
                    });
                    $("#div-select-proveedor").addClass('has-error');
                } else {
                    $("#div-select-proveedor").removeClass('has-error');
                };
                if (categoria == "") {
                    //$("#mensaje").html('<div class="label label-warning">Debe seleccionar una categoria</div>');
                    swal({
                        title: "Requerido <small>(*)</small>",
                        text: '<strong>Debe seleccionar una categoria<strong>.',
                        type: "warning",
                    });
                    $("#div-select-categoria").addClass('has-error');
                } else {
                    $("#div-select-categoria").removeClass('has-error');
                };
                if (modelo == "") {
                    //$("#mensaje").html('<div class="label label-warning">Debe seleccionar un modelo</div>');
                    swal({
                        title: "Requerido <small>(*)</small>",
                        text: '<strong>Debe seleccionar una modelo<strong>.',
                        type: "warning",
                    });
                    $("#div-select-modelo").addClass('has-error');
                } else {
                    $("#div-select-modelo").removeClass('has-error');
                };
                if (marca == "") {
                    //$("#mensaje").html('<div class="label label-warning">Debe seleccionar una marca</div>');
                    swal({
                        title: "Requerido <small>(*)</small>",
                        text: '<strong>Debe seleccionar una marca<strong>.',
                        type: "warning",
                    });
                    $("#div-select-marca").addClass('has-error');
                } else {
                    $("#div-select-marca").removeClass('has-error');
                };
                if (nombre.length < 3) {
                    $("#nombre").focus();
                    //$("#mensaje").html('<div class="label label-warning">El nombre debe tener al menos 3 caracteres</div>');
                    swal({
                        title: "Requerido <small>(*)</small>",
                        text: '<strong>El nombre debe tener al menos 3 caracteres<strong>.',
                        type: "warning",
                    });
                    $("#div-nombre").addClass('has-error');
                };
                if (nombre == "") {
                    $("#nombre").focus();
                    //$("#mensaje").html('<div class="label label-warning">El nombre es requerido</div>');
                    swal({
                        title: "Requerido <small>(*)</small>",
                        text: '<strong>El nombre es requerido<strong>.',
                        type: "warning",
                    });
                } else if (nombre.length < 3) {
                    $("#nombre").focus();
                    //$("#mensaje").html('<div class="label label-warning">El nombre debe tener al menos 3 caracteres</div>');
                    swal({
                        title: "Requerido <small>(*)</small>",
                        text: '<strong>El nombre debe tener al menos 3 caracteres<strong>.',
                        type: "warning",
                    });
                    $("#div-nombre").addClass('has-error');
                }

                else if (nombre != "") {
                    $("#div-nombre").removeClass('has-error');
                    $("#div-nombre").addClass('has-success');
                }
            });
            function calcularPrecios() {
                var incremento1 = 10 / 100;
                var incremento2 = 15 / 100;
                var incremento3 = 20 / 100;
                var preciocosto = parseInt($('#preciocosto').val());
                $('#precioventa1').val(preciocosto * incremento1 + preciocosto);
                $('#precioventa2').val(preciocosto * incremento2 + preciocosto);
                $('#precioventa3').val(preciocosto * incremento3 + preciocosto);
            }
            $("#preciocosto").click(function () {
                $('#preciocosto').val('');
            });
            $('#stockminimo').val(10);
            $('#stockmaximo').val(100);
            $("#preciocosto").keyup(function () {
                var incremento1 = 20 / 100;
                var incremento2 = 35 / 100;
                var incremento3 = 40 / 100;
                var preciocosto = parseInt($('#preciocosto').val());
                $('#precioventa1').val(preciocosto * incremento1 + preciocosto);
                $('#precioventa2').val(preciocosto * incremento2 + preciocosto);
                $('#precioventa3').val(preciocosto * incremento3 + preciocosto);
            });
        });
    </script>


</body>
</html>